(()=>{"use strict";function e(e){var o;e.classList.add("popup_is-opened"),(o=e).querySelector(".popup__close").addEventListener("click",(function(){return t(o)})),o.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&t(o)})),window.addEventListener("keypress",n)}function t(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keypress",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function o(e,t,n,o){var r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=r.querySelector(".card__delete-button"),a=r.querySelector(".card__image"),i=r.querySelector(".card__title"),u=r.querySelector(".card__like-button"),s=r.querySelector(".card__like-count");return i.textContent=e.name,a.src=e.link,a.alt=e.name,s.textContent=e.likes.length,c.addEventListener("click",(function(){return t(r)})),u.addEventListener("click",(function(){return n(u)})),a.addEventListener("click",(function(){return o(e)})),r}function r(e){e.remove()}function c(e){e.classList.toggle("card__like-button_is-active")}function a(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function u(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t),n.value=""})),o.classList.add(t.inactiveButtonClass),o.disabled=!0}var s={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"2069e1e7-1fc1-4853-b683-9a0d07c1d4f9","Content-Type":"application/json"}},l=document.querySelector(".content"),p=l.querySelector(".profile__image"),d=l.querySelector(".profile__title"),f=l.querySelector(".profile__description"),_=l.querySelector(".places__list"),m=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup_type_image"),S=m.querySelector(".popup__input_type_name"),h=m.querySelector(".popup__input_type_description"),q=v.querySelector(".popup__input_type_card-name"),b=v.querySelector(".popup__input_type_url"),g=l.querySelector(".profile__edit-button"),k=l.querySelector(".profile__add-button");function C(e){var t=y.querySelector(".popup__image"),n=y.querySelector(".popup__caption");t.src=e.link,t.alt=e.alt,n.textContent=e.name}g.addEventListener("click",(function(){e(m),S.value=d.textContent,h.value=f.textContent,u(m,A)})),k.addEventListener("click",(function(){return e(v)})),_.addEventListener("click",(function(t){t.target.classList.contains("card__image")&&e(y)})),m.addEventListener("submit",(function(e){var n,o;e.preventDefault(),(n=S.value,o=h.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:"".concat(n),about:"".concat(o)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){e&&(d.textContent=e.name,f.textContent=e.about,console.log("Данные профиля успешно обновлены"))})).catch((function(e){console.log("Не удалось обновить данные профиля: ".concat(e))})),t(m)})),v.addEventListener("submit",(function(e){var n,a;e.preventDefault(),(n=q.value,a=b.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:"".concat(n),link:"".concat(a),alt:"".concat(n)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){if(e){var t=o({name:e.name,link:e.link,alt:e.name,likes:e.likes},r,c,C);_.prepend(t),console.log("Карточка добавлена успешно")}})).catch((function(e){console.log("Не удалось добавить карточку: ".concat(e))})),u(v,A),t(v)}));var L,E,x,j,A={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);i(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){/^[a-zA-Zа-яА-ЯёË\s\-]+$/.test(t.value)||"name-input"!==t.id&&"place-name-input"!==t.id&&"description-input"!==t.id||!t.value?t.setCustomValidity(""):t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"),t.validity.valid?a(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),i(n,o,t)}))}))}(t,e)}))}(A),L=d,E=f,x=p,fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(e){e&&(L.textContent=e.name,E.textContent=e.about,x.style.backgroundImage="url('".concat(e.avatar,"')"),console.log("Профиль успешно загружен"))})).catch((function(e){console.log("Не удалось загрузить профиль: ".concat(e)),E.textContent="Не удалось загрузить профиль: ".concat(e)})),j=function(e){var t=o(e,r,c,C);_.append(t)},fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(e){e&&(e.forEach(j),console.log("Карточки успешно загружены"))})).catch((function(e){console.log("Не удалось загрузить карточки: ".concat(e))}))})();